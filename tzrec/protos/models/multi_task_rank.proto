syntax = "proto2";
package tzrec.protos;

import "tzrec/protos/module.proto";
import "tzrec/protos/tower.proto";

message SimpleMultiTask {
    repeated TaskTower task_towers = 1;
}

message MMoE {
    // mmoe expert module definition
    required MLP expert_mlp = 1;
    // mmoe gate module definition
    optional MLP gate_mlp = 2;
    // number of mmoe experts
    required uint32 num_expert = 3 [default=3];
    // task tower
    repeated TaskTower task_towers = 4;
}

message DBMTL {
    // shared bottom MaskNet module
    optional MaskNetModule mask_net = 6;
    // shared bottom mlp layer
    optional MLP bottom_mlp = 1;
    // mmoe expert mlp layer definition
    optional MLP expert_mlp = 2;
    // mmoe gate module definition
    optional MLP gate_mlp = 3;
    // number of mmoe experts
    optional uint32 num_expert = 4 [default=3];
    // bayes task tower
    repeated BayesTaskTower task_towers = 5;
}

message DC2VR {
    // shared bottom mlp layer
    optional MLP bottom_mlp = 1;
    // mmoe expert mlp layer definition
    optional MLP expert_mlp = 2;
    // mmoe gate module definition
    optional MLP gate_mlp = 3;
    // number of mmoe experts
    optional uint32 num_expert = 4 [default=3];
    // task tower
    repeated InterventionTaskTower task_towers = 5;
}



message PLE {
    // extraction network
    repeated ExtractionNetwork extraction_networks = 1;
    // task tower
    repeated TaskTower task_towers = 2;
}


message DlrmHSTU {
    // hstu config
    required HSTU hstu = 1;
    // multi task tower config
    required FusionMTLTower fusion_mtl_tower = 2;
    // max sequence length
    required uint32 max_seq_len = 3;
    // item embedding mlp hidden dimension
    optional uint32 item_embedding_hidden_dim = 4 [default = 512];
    // enables loss averaging computation globally across all ranks (total rank)
    // instead of locally (local rank).
    optional bool enable_global_average_loss = 5 [default = true];
}

message PEPNet {
    // all feature group name
    required string main_group_name = 1;
    // domain feature group name
    optional string domain_group_name = 2;
    // epnet hidden units
    optional uint32 epnet_hidden_unit = 3;
    // activation function for epnet
    optional float  epnet_gamma = 4 [default = 2.0];
    // user,item,author feature group name
    optional string uia_group_name = 5;
    // ppnet hidden units
    repeated uint32 ppnet_hidden_units = 6;
    // activation function for ppnet
    optional string ppnet_activation = 7 [default = 'nn.ReLU'];
    // ratio of dropout
    repeated float ppnet_dropout_ratio = 8;
    optional float  ppnet_gamma = 9 [default = 2.0];
    // task tower
    repeated TaskTower task_towers = 10;
}
